@{
    Layout = null;
}

<!--右侧实体内容-->
<div id="partPage">
    <!--标题-->
    <div class="head-fixed" onclick="loadPage('/Main/approval')">
        <i class="el-icon-arrow-left"></i>
        项目列表
    </div>
    <!--检索项目表单-->
    <el-form :inline="true" :model="formInline" class="demo-form-inline"
             size="medium">
        <el-form-item label="关键字">
            <el-input v-model="formInline.key" style="width:200px;"
                      placeholder="请输入搜索关键字"></el-input>
        </el-form-item>
        <!--高级检索-时间-->
        <template v-if="superSearch">
            <el-form-item label="开始日期">
                <el-date-picker v-model="formInline.time"
                                type="daterange"
                                :picker-options="pickerOptions"
                                value-format="yyyy-MM-dd"
                                range-separator="至"
                                start-placeholder="开始日期"
                                end-placeholder="结束日期">
                </el-date-picker>
            </el-form-item>

            @*<el-form-item label="部门">
                <el-select v-model="formInline.Customer">
                    <el-option label="全部" value=""></el-option>
                    <el-option v-for="c of Customer" :label="c" :value="c" key="c"></el-option>
                </el-select>
            </el-form-item>*@

            <!--高级检索-表单选项-->
            <el-form-item>
                <el-checkbox-group v-model="formInline.projectState" :min="1">
                    <el-checkbox v-for="t in tableOptions" :label="t" :key="t">{{t}}</el-checkbox>
                </el-checkbox-group>
            </el-form-item>
        </template>
        
        <el-form-item>
            <el-button type="primary" v-on:click="getProject">搜索</el-button>
            <span v-if="superSearch" v-on:click="superSearch = !superSearch" class="clickable-text">关闭高级搜索</span>
            <span v-else v-on:click="superSearch = !superSearch" class="clickable-text">高级搜索</span>
        </el-form-item>
    </el-form>
    <!--表格實體-->
    <el-table :data="tableData" stripe border>
        <el-table-column type="expand">
            <template slot-scope="props">
                <el-form label-position="left" inline class="table-expand">
                    <el-form-item label="创建时间">
                        <span>{{ props.row.CreateTime }}</span>
                    </el-form-item>
                    <el-form-item label="开始时间">
                        <span>{{ props.row.StartTime }}</span>
                    </el-form-item>
                    <el-form-item label="结束时间">
                        <span>{{ props.row.EndTime }}</span>
                    </el-form-item>
                </el-form>
            </template>
        </el-table-column>
        <el-table-column prop="ProjectId" label="项目编号"></el-table-column>
        <el-table-column prop="ProjectName" label="项目名称"></el-table-column>
        <el-table-column prop="DeptName" label="部门名称"></el-table-column>
        <el-table-column prop="ApplyMan" label="创建人"></el-table-column>
        <el-table-column prop="ResponsibleMan" label="项目负责人"></el-table-column>
        <el-table-column prop="ProjectState" label="状态"></el-table-column>
        @*<el-table-column label="操作" style="width:300px;">
            <template slot-scope="scope" style="width:300px;">
                <el-button size="mini" v-on:click="handleEdit(scope.$index, scope.row)">详情</el-button>
                <el-button size="mini" type="danger" v-on:click="handleDelete(scope.$index, scope.row)">删除</el-button>
            </template>
        </el-table-column>>*@
    </el-table>
    <!--底部翻頁-->
    <div style="text-align:right">
        <el-pagination v-on:size-change="handleSizeChange"
                       v-on:current-change="handleCurrentChange"
                       :current-page="currentPage"
                       :page-sizes="[1, 3, 5, 10]"
                       :page-size="5"
                       layout="total, sizes, prev, pager, next, jumper"
                       :total="totalRows">
        </el-pagination>
    </div>
</div>


<script>
    var Index = 0
    var VUE = new Vue({
        el: "#partPage",
        mixins: [mixin],
        data: function () {
            return {
                data: [],
                tableData: [],
                superSearch: false,
                formInline: {
                    key: '',
                    time: ['',''],
                    projectState: ["在研", "已完成", "终止"]
                },
                tableOptions: ["在研", "已完成", "终止"],
                isIndeterminate: true
            }
        },
        methods: {
            //获取项目数据getProject
            getProject() {
                var that = this
                var param = {
                    key: this.formInline.key,
                    startTime: this.formInline.time[0],
                    endTime: this.formInline.time[1],
                    projectState: this.formInline.projectState.join('_')
                }
                url = "/Project/QuaryProjectInfo" + _formatQueryStr(param)
                $.ajax({
                    url: url,
                    type: "GET",
                    dataType: "json",
                    success: function (data) {
                        console.log("获取项目列表数据 QuaryProjectInfo")
                        console.log(url)
                        console.log(data)
                        that.data = data
                        that.totalRows = data.length
                        that.getData()
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        console.log(XMLHttpRequest.status);
                    }
                })
            },
            //表单操作
            handleEdit(index, row) {
                console.log(index, row);
                
            },
            handleDelete(index, row) {
                console.log(index, row);
            }
        },
        created: function () {
            this.getProject()
            loadHtml("mainPage", "partPage")
        }
    })


</script>