@{
    Layout = null;
}

<!--右侧实体内容-->
<el-main id="partPage" style="position:relative;">
    <div class="head-fixed" onclick="loadPage('/Main/approval')">
        <i class="el-icon-arrow-left"></i>
        上传图纸
    </div>
    <!--表格實體-->
    <el-table :data="tableData" stripe border>
        <el-table-column v-for="(i,index) in items" :prop="index" :label="i">
        </el-table-column>
    </el-table>
    <!--底部翻頁-->
    <div style="text-align:right">
        <el-pagination v-on:size-change="handleSizeChange"
                       v-on:current-change="handleCurrentChange"
                       :current-page="currentPage"
                       :page-sizes="[1, 3, 5, 10]"
                       :page-size="pageSize"
                       layout="total, sizes, prev, pager, next, jumper"
                       :total="totalRows">
        </el-pagination>
    </div>
    <!--上传表單-->
    <el-upload class="upload-demo"
                action="/drawingupload/UploadAndGetInfo"
                :on-preview="handlePreview"
                :on-remove="handleRemove"
                :on-success="handleSuccess"
                :before-remove="beforeRemove"
                multiple
                :limit="3"
                :on-exceed="handleExceed"
                :file-list="fileList">
        <el-button size="small" type="primary">点击上传</el-button>
        <div slot="tip" class="el-upload__tip">只能上传excel文件，且不超过500kb</div>
    </el-upload>
</el-main>

<script>
    var demo = new Vue({
        el: "#partPage",
        mixins: [mixin],
        data: function () {
            return {
                fileList: [],
                data: [],
                tableData: [],
                currentPage: 1,
                pageSize: 10,
                totalRows: 0,
                items:{}
            }
        },
        methods: {
            //上传文件方法
            handleSuccess(response, file, fileList) {
                console.log(response, file, fileList);
                if (!(response && response.length > 0)) return
                for (let i = 0; i < response.length; i++) {
                    let data = response[i]
                    if (i == 0) {
                        this.items = {}
                        for (let c in data) {
                            if (c.substring(0, 6) == 'Column') {
                                this.items[c] = data[c]
                            }
                        }
                    } else {
                        if (data['Column1'] && data['Column1'] != "")
                            this.data.push(data)
                    }
                }
                this.totalRows = this.data.length
                this.getTableData()
                console.log(this.items)
                console.log(this.tableData)
            },
            getTableData() {
                var start = this.pageSize * (this.currentPage - 1)
                this.tableData = this.data.slice(start, start + this.pageSize)
            },
            handleRemove(file, fileList) {
                console.log(file, fileList);
            },
            handlePreview(file) {
                console.log(file);
            },
            handleExceed(files, fileList) {
                this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${files.length} 个文件，共选择了 ${files.length + fileList.length} 个文件`);
            },
            beforeRemove(file, fileList) {
                return this.$confirm(`确定移除 ${file.name}？`);
            },
            //翻頁相關事件
            handleSizeChange: function (val) {
                this.currentPage = 1
                this.pageSize = val
                this.getTableData()
            },
            handleCurrentChange: function (val) {
                this.currentPage = val
                this.getTableData()
            },
        },
        created: function () {
            loadHtml("mainPage", "partPage")
        }
    })
</script>

<style>
    .upload-demo{
        width:400px;
    }
</style>

