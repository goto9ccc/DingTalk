@{
    Layout = null;
}

<!--右侧实体内容-->
<div id="partPage">
    <!--标题-->
    <div class="head-fixed" onclick="loadPage('/Main/approval')">
        <i class="el-icon-arrow-left"></i>
        添加项目
    </div>
    <!--创建项目表单-->
    <el-form :model="ruleForm" :rules="rules" ref="ruleForm" label-width="100px" class="demo-ruleForm"
             enctype="multipart/form-data">
        <template>
            <el-form-item label="项目名称" prop="inputProjectName" style="width:300px;">
                <el-input v-model="ruleForm.inputProjectName"></el-input>
            </el-form-item>
            <el-form-item label="项目编号" prop="inputProjectId" style="width:300px;">
                <el-input v-model="ruleForm.inputProjectId"></el-input>
            </el-form-item>
            <el-form-item label="部门名称" style="width:300px;">
                <el-input v-model="ruleForm.DeptName"></el-input>
            </el-form-item>
            <el-form-item label="状态">
                <el-select v-model="ruleForm.ProjectState">
                    <el-option v-for="s of status" :label="s" :value="s" key="s"></el-option>
                </el-select>
            </el-form-item>
            <el-form-item label="项目负责人" required="required">
                <span>{{ResponsibleMan}}</span>
                <el-button class="button-new-tag" size="small" v-on:click="addMan">+ 选择</el-button>
            </el-form-item>
            <el-form-item label="开始日期">
                <el-date-picker v-model="ruleForm.Time"
                                type="daterange"
                                :picker-options="pickerOptions"
                                range-separator="至"
                                start-placeholder="开始日期"
                                end-placeholder="结束日期">
                </el-date-picker>
            </el-form-item>
            <el-form-item>
                <el-button type="primary" v-on:click="addProject">添加</el-button>
            </el-form-item>
        </template>
    </el-form>
</div>


<script>
    var Index = 0
    new Vue({
        el: "#partPage",
        mixins: [mixin],
        data: function () {
            return {
                status: ['在研', '已完成', '终止'],
                ResponsibleMan: '',
                ruleForm: {
                    inputProjectName: '',
                    inputProjectId: '',
                    DeptName: '',
                    ProjectState: '',
                    ProjectName: '',
                    ProjectId: null,
                    Time: ''
                }
            }
        },
        methods: {
            //添加项目
            addMan() {
                var that = this
                var param = {
                    "ProjectName": this.ruleForm.inputProjectName,
                    "CreateTime": _getTime(),
                    "IsEnable": true,
                    "ProjectState": this.ruleForm.ProjectState,
                    "IsFinish": false,
                    "DeptName": this.ruleForm.DeptName,
                    "ApplyMan": DingData.nickName,
                    "ApplyManId": DingData.userid,
                    "StartTime": _dateToString(this.ruleForm.Time[0]),
                    "EndTime": _dateToString(this.ruleForm.Time[1]),
                    "ProjectId": this.ruleForm.inputProjectId,
                    "ResponsibleMan": '',
                    "ResponsibleManId": ''
                }
                console.log(param)
                $.ajax({
                    url: "/Project/AddProject",
                    type: "POST",
                    dataType: "json",
                    async: false,
                    data: JSON.stringify(param),
                    success: function (data) {
                        that.projestList.push({
                            ProjectId: that.ruleForm.inputProjectId,
                            ProjectName: that.ruleForm.inputProjectName
                        })
                        console.log(data);
                        that.showAddProject = false
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        console.log(XMLHttpRequest.status);
                    }
                })
            },
            addPeople() {
                var that = this
                console.log('addPeople')
                DingTalkPC.biz.contact.choose({
                    multiple: false, //是否多选： true多选 false单选； 默认true
                    users: [], //默认选中的用户列表，员工userid；成功回调中应包含该信息
                    corpId: DingData.CorpId, //企业id
                    onSuccess: function (data) {
                        that.ResponsibleMan = data
                        console.log(data)
                    },
                    onFail: function (err) { }
                });
            },
        },
        created: function () {
            loadHtml("mainPage", "partPage")
        }
    })


</script>